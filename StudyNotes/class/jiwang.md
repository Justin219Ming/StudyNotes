# 计算机网络

## 序章



## 物理层

### 宽带

FFC定义下行速率25M 上行速率3M

###　ADSL技术

非对称数字用户线ADSL

- 非对称 下行带宽远大于上行
- 把0~4kHz留给传统电话 高频段用于上网
- ADSL用了频分复用的方式 分频段来区分
- ADSL最大好处可以利用现有电话网的用户线，不需要重新布线

ADSL不适用于企业，企业需要大量的上行信道，需要发送大量数据给用户

（xDSL 很多不同的DSL 解决不同的问题）

### 2.6.2 光纤同轴混合网（HFC网）

主道用光纤，用户道用同轴（铜）电缆

- 机顶盒
- 电缆调制解调器

### 2.6.3 FTTx技术

代表多种宽带光纤接入方式

FTTH （Home） 光纤到户

光配线网ODN

多个用户共用一条光纤干线 进行传输和接受数据（到不同用户的时候会分开）

### 码分复用

- A * A  = +1
- A * A' = -1
- A * T  =  0
- A * T' =  0

当A站想要发送比特1 那么他就发送A的正交内积结果为1的序列

想要发送比特0 那么他就发送A的正交内积结果为-1的序列

什么都不发送 就是T  与A的正交内积结果为0

**正交内积就是按顺序一个一个相乘再相加起来 最后除以8**

## 数据链路层

网络中的主机、路由器等都必须实现数据链路层

- 交换机 物理层 和 数据链路层

- 路由器 物理层 数据链路层 网络层（拿到IP地址 找到对应出口）

### 数据链路层信道类型

- 点对点  一对一
- 广播通信 一对多 （需要定制好共享信道协议）

### 3.1.1 数据链路和帧

1. 链路 （物理链路）

2. 数据链路 （逻辑链路） = 控制协议的硬件+软件     典型实现：适配器（网卡）

#### 数据链路层协议数据单元：帧

来自网络层的IP数据报，在数据链路层封装（首尾都加上封装的数据）成为帧

### 3.1.2 三个基本问题

#### 封装成帧

在一段数据的前后分别添加首部和尾部，构成一个帧

最大传送单元MTU：能传送的帧的数据部分长度上限

帧定界符

用控制字符作为帧定界符 SOH EOT

#### 透明传输

透明指的是 忽略问题

举例 现在你的数据中有EOT的字符 但你没有想结束 导致数据错误

解决的方法是通过添加转义字符 比如说C中printf（“\n”） 中的\

#### 差错控制

循环冗余检验CRC

原始数据k位+n位冗余码    

事先约定好除数P n+1位

- 若相除之后余数=0 接受方接受

- 若余数!=0 接受方丢弃

用的是模2除法

不进位不退位

**CRC冗余码计算**

冗余码成为帧检验序列 FCS（不是只有CRC能得到FCS）

注意：无差错接受 （CRC还是有可能出现差错的 只是这个概率很小所以我们认为它没有出现差错）

使用CRC检验，我们认为实现了无比特差错

- 传输差错：帧丢失 帧重复 帧失序
- 比特差错

可靠传输：百分百一样

### PPP协议（数据链路层）

用户接入到ISP中 通过PPP协议

应满足的需求：

- 简单
- 封装成帧
- 透明性
- 等等

组成部分：

- 网络控制协议

- 链路控制协议

- 自动检测

PPP有一个2个字节的协议字段。其值

- 0x0021，则信息部分是IP数据报
- 0x8021，信息部分是网络控制数据
- 0xC021，信息部分是PPP链路控制数据

PPP长度是字节的整数倍

- 零比特填充 ： 在5个连续1后填入0

### 3.2.3 PPP协议的工作状态

PPP协议的状态图（补充）

### 3.3使用广播信道的数据链路层

静态划分信道：

- 频分复用
- 时分复用
- 波分复用
- 码分复用

### 适配器的作用（网卡）

进行串行并行转换

数据缓存

安装驱动程序

实现以太网的协议

### CSMA/CD 协议

当数据帧中的目的地址和适配器地址一样的时候，接受数据

- 多点接入： 多台计算机以多点接入连在一根总线上
- 载波监听： 一边发送一边监听
- 碰撞检测： 检测信号电压变化，电压摆动值超过一定阈值，认为发生碰撞

发生碰撞之后，会立刻停止发送，在之后的随机时间再重新发送

协议的工作流程（可以补充流程图） 

#### 碰撞检测

在发送完之后的2倍传播时延中，称为碰撞窗口

只有过了这段时间也没有检测到碰撞，可以认为没有发生碰撞

#### 碰撞后重传

截断二进制指数退避（动态退避）

1. 基本退避时间 2t
2. 从集合里面选一个数*2t  集合大小和重传次数有关 第一次为0,1 第二次为0,1,2,3 依次类推
3. 

#### 10Mbit/s以太网争用期长度

time=51.2μs

对于这种以太网来说，在争用期可以发送512bit，等于64字节

以太网规定最短有效帧长度为64字节

以太网最大端到端的单程距离是time的一半

大约5km长度

发送帧与帧之间的间隔是9.6微秒

#### 以太网采取的措施：

- 灵活的无连接的工作方式
- 发送数据用曼彻斯特编码（缺点 占用的信道宽度？多了一倍）

#### 参数a 利用率

定义 a = t/T0

也就是以太网单程端到端时间延迟t与帧发送时间T0之比

根据这个公式的衍生的要求

- a越小越好
- 以太网连线的长度要受到限制
- 帧长不能太短

信道利用率的最大值Smax = 1/(1+a)

### 3.3.5 以太网的MAC层

适配器（网卡）有48位的MAC地址

每一个适配器都是唯一的MAC地址

第1字节的最低位

- 单站地址 为0
- 组地址：多播 为1
- 广播地址：所有48位全为1 只能作为目的地址使用

第2字节

- 全球管理 为0 IEEE
- 本地管理 为1

### 适配器有过滤功能

- 每收到一个MAC帧，先检查帧的MAC地址
- 是发送本站的接受，不是发送本站的丢弃

### V2的MAC帧格式

字节数量

| ---      | ---    | ---  | ---     |      |
| -------- | ------ | ---- | ------- | ---- |
| 目的地址 | 源地址 | 类型 | 数据    | FCS  |
| 6        | 6      | 2    | 46-1500 | 4    |

如果数据字段小于46字节那么要进行数据填充，否则无法满足一个帧的长度

IEEE 802.3与V2的区别

在类型字段 如果小于0x6000？ 那么他填充的内容代表的是数据的长度 大于表示的是类型

### 3.4.1在物理层扩展以太网

- 使用集线器扩展 （在逻辑上来说是总线结构 容易碰撞）

  优点 原来不同碰撞域的计算机跨碰撞通信

  缺点 碰撞域变大 发送碰撞概率变大

### 在数据链路层扩展以太网

早期使用网桥 根据MAC帧的目的地址进行转发 过滤 丢弃 

现在用以太网交换机

交换机有物理层 和 数据链路层 

有多个进出口 所以每一个接口都是一个碰撞域

是一个多端口的网桥 

全双工方式 （进出不用同一个路径）

可以无碰撞的进行转发

接口有存储器

内部有帧的交换表，通过自学习算法建立交换表（即插即用）

使用专门的硬件转发

每个用户独享带宽

#### 交换方式

- 存储转发
- 直通方式（有可能有无效帧）

#### 自学习功能(复习)

| MAC地址 | 接口 | 有效时间 |
| ------- | ---- | -------- |
| A       | 1    |          |
| E       | 5    |          |
|         |      |          |

A向B发送了一帧

自学习加入MAC地址为A 和对应接口

查表

没有B的接口信息

向每一个接口都发送A对B的帧 用户主机识别 不是发给自己的 丢弃

E向A 发送一帧

自学习加入E 和 接口

查表发现有A信息

直接发送给接口1